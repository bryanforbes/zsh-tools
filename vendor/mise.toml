[task_config]
dir = "{{ config_root }}/zsh"

[tasks.clean]
description = "Clean the Zsh source directory"
run = [
  'git clean -Xdf',
  'rm -f ../zsh_compile_commands.json',
]

[tasks."prepare:preconfigure"]
description = "Run the preconfig script for Zsh"
wait_for = [':clean']
sources = ["configure.ac"]
outputs = ["configure"]
run = './Util/preconfig'

[tasks."prepare:configure"]
description = "Run configure for Zsh"
depends = ':prepare:preconfigure'
sources = ["configure", "config.h.in"]
outputs = ["config.h"]
run = './configure'

[tasks."prepare:build"]
description = "Build Zsh for extraction"
depends = ':prepare:configure'
sources = ["**/*.c", "Src/zsh.h"]
outputs = ["Src/zsh", "zsh_compile_commands.json"]
run = 'bear --output {{config_root}}/zsh_compile_commands.json -- make'

[tasks.prepare]
description = "Prepare the Zsh source"
depends = ':prepare:*'
